
# TODO: group focus lost when focusing to its new workspace

# Common functions
set $get_workspaces $(swaymsg -rt get_workspaces | jq -r '.[].num')
set $get_prev_workspace $(( $( swaymsg -t get_workspaces | jq '.[] | select(.focused).num' ) - 1 )) && n=$(( $n < 1 ? 1 : ($n < 9 ? $n : 9) ))
set $get_next_workspace $(( $( swaymsg -t get_workspaces | jq '.[] | select(.focused).num' ) + 1 )) && n=$(( $n < 1 ? 1 : ($n < 9 ? $n : 9) ))
set $get_empty_workspace $(swaymsg -rt get_workspaces | jq '. as $w | first(range(0; 9) + 1 | select(all(. != $w[].num; .)))')

# Appearance
output * bg #101010 solid_color
default_border pixel 2
default_floating_border pixel 2
for_window [class=".*"]  border pixel 2
for_window [app_id=".*"] border pixel 2
font Terminus (TTF) 12
client.focused           #202020 #ffffff #000000 #ff0000 #ffffff
client.focused_inactive  #202020 #202020 #ffffff #202020 #202020
client.focused_tab_title #202020 #ffffff #000000
client.unfocused         #202020 #202020 #808080 #202020 #202020

# Startup scripts and daemons
# Import envvars into dbus user session
exec_always systemctl --user import-environment DISPLAY WAYLAND_DISPLAY SWAYSOCK XDG_CURRENT_DESKTOP
# Notifications
exec_always pidof mako || mako
# Battery warning notifications
exec_always pidof -x batteryd || batteryd
# Clipboard manager
exec_always pidof wl-paste || wl-paste --watch cliphist store
# Idle locking + suspending
exec_always powerctl uncaffeinate
# Output setup
exec displayctl mono
# Bars
# TODO: multimonitor bars
bar {
	swaybar_command waybar
	mode hide
}

# Input devices
input type:keyboard {
    xkb_layout ie
    xkb_options caps:escape
    repeat_delay 250
    repeat_rate 30
}
input type:touchpad {
    dwt disabled
    tap enabled
    natural_scroll enabled
    click_method clickfinger
    scroll_method two_finger
}

# Mouse
floating_modifier Mod4 normal
focus_follows_mouse no
mouse_warping output

# Program shortcuts
bindsym Mod4+space                   exec flock -n /tmp/wofi.lock wofi --prompt "" --show "run,drun"
bindsym Mod4+Return                  exec $TERMINAL
bindsym Mod4+t                       exec $TERMINAL
bindsym Mod4+w                       exec $BROWSER
bindsym Mod4+d                       exec discord
bindsym Mod4+s                       exec flameshot gui --delay 50 --raw | wl-copy --type image/png
bindsym Mod4+Shift+s                 exec flameshot gui --delay 50 --raw --accept-on-select | wl-copy --type image/png
bindsym Mod4+Escape                  exec powerctl
bindsym --locked Mod4+Shift+Escape   exec powerctl lock
bindsym --locked Mod4+Control+Escape exec powerctl suspend
bindsym Mod4+Control+Shift+Escape    exec powerctl reload
bindsym Mod4+backslash               exec displayctl
bindsym Mod4+Shift+backslash         exec displayctl mono
bindsym Mod4+Control+backslash       exec displayctl duel
bindsym Mod4+n                       exec networkctl
bindsym Mod4+Shift+n                 exec networkctl wifi
bindsym Mod4+Control+n               exec networkctl bluetooth
bindsym Mod4+b                       border pixel 2
bindsym Mod4+shift+b                 border none
bindsym Mod4+v                       exec CH_PROMPT="Clipboard" choose "$(cliphist list)" | cliphist decode | wl-copy
bindsym Mod4+grave                   exec makoctl dismiss
bindsym Mod4+Shift+grave             exec makoctl restore
bindsym Mod4+Control+grave           exec makoctl menu wofi --dmenu --prompt "Action"

# Windows
focus_wrapping no
bindsym Mod4+h focus left
bindsym Mod4+j focus down
bindsym Mod4+k focus up
bindsym Mod4+l focus right
bindsym Mod4+Shift+h move left 50px
bindsym Mod4+Shift+j move down 50px
bindsym Mod4+Shift+k move up 50px
bindsym Mod4+Shift+l move right 50px
bindsym Mod4+Control+h resize shrink width 50px
bindsym Mod4+Control+j resize grow height 50px
bindsym Mod4+Control+k resize shrink height 50px
bindsym Mod4+Control+l resize grow width 50px
# TODO: just move between all windows in workspace
bindsym Mod4+Tab       exec echo todo
bindsym Mod4+Shift+Tab exec echo todo
bindsym Mod4+f focus mode_toggle
bindsym Mod4+Shift+f border pixel 2, floating toggle
bindsym Mod4+x sticky toggle
bindsym Mod4+m fullscreen
bindsym Mod4+q kill

# Workspaces
bindsym Mod4+1 workspace number 1
bindsym Mod4+2 workspace number 2
bindsym Mod4+3 workspace number 3
bindsym Mod4+4 workspace number 4
bindsym Mod4+5 workspace number 5
bindsym Mod4+6 workspace number 6
bindsym Mod4+7 workspace number 7
bindsym Mod4+8 workspace number 8
bindsym Mod4+9 workspace number 9
bindsym Mod4+Shift+1 move container workspace number 1, workspace number 1
bindsym Mod4+Shift+2 move container workspace number 2, workspace number 2
bindsym Mod4+Shift+3 move container workspace number 3, workspace number 3
bindsym Mod4+Shift+4 move container workspace number 4, workspace number 4
bindsym Mod4+Shift+5 move container workspace number 5, workspace number 5
bindsym Mod4+Shift+6 move container workspace number 6, workspace number 6
bindsym Mod4+Shift+7 move container workspace number 7, workspace number 7
bindsym Mod4+Shift+8 move container workspace number 8, workspace number 8
bindsym Mod4+Shift+9 move container workspace number 9, workspace number 9
bindsym Mod4+Control+1 move container workspace number 1
bindsym Mod4+Control+2 move container workspace number 2
bindsym Mod4+Control+3 move container workspace number 3
bindsym Mod4+Control+4 move container workspace number 4
bindsym Mod4+Control+5 move container workspace number 5
bindsym Mod4+Control+6 move container workspace number 6
bindsym Mod4+Control+7 move container workspace number 7
bindsym Mod4+Control+8 move container workspace number 8
bindsym Mod4+Control+9 move container workspace number 9
# TODO: moving workspaces around and between outputs (auto renaming?)
#bindsym Mod4+Control+Shift+h move workspace left
#bindsym Mod4+Control+Shift+j move workspace output down
#bindsym Mod4+Control+Shift+k move workspace output up
#bindsym Mod4+Control+Shift+l move workspace right
bindsym Mod4+Comma                exec n=$get_prev_workspace && swaymsg workspace number $n
bindsym Mod4+Period               exec n=$get_next_workspace && swaymsg workspace number $n
bindsym Mod4+Shift+Comma          exec n=$get_prev_workspace && swaymsg move container workspace $n && swaymsg workspace number $n
bindsym Mod4+Shift+Period         exec n=$get_next_workspace && swaymsg move container workspace $n && swaymsg workspace number $n
bindsym Mod4+Control+Comma        exec n=$get_prev_workspace && swaymsg move container workspace number $n
bindsym Mod4+Control+Period       exec n=$get_next_workspace && swaymsg move container workspace number $n
bindsym Mod4+Control+Shift+Comma  exec "w=$get_workspaces && swaymsg $(for n in $w; do echo rename workspace $n to x$n,; done; for n in $w; do echo rename workspace x$n to $(( 9 - ((9 - ($n - 1)) % 9) )),; done)"
bindsym Mod4+Control+Shift+Period exec "w=$get_workspaces && swaymsg $(for n in $w; do echo rename workspace $n to x$n,; done; for n in $w; do echo rename workspace x$n to $(( $n % 9 + 1 )),;               done)"
bindsym Mod4+z                    exec n=$get_empty_workspace && swaymsg workspace number $n
bindsym Mod4+Shift+z              exec n=$get_empty_workspace && swaymsg move container workspace $n && swaymsg workspace number $n
bindsym Mod4+Control+z            exec n=$get_empty_workspace && swaymsg move container workspace number $n
bindsym Mod4+Control+Shift+z      exec "i=1; for n in $get_workspaces; do swaymsg rename workspace $n to $i; i=$(( $i + 1 )); done"

# Layout
default_orientation auto
bindsym Mod4+g       focus parent
bindsym Mod4+Shift+g focus child
bindsym Mod4+p       split vertical
bindsym Mod4+Shift+p split none
bindsym Mod4+o       layout toggle splitv splith
bindsym Mod4+Shift+o layout toggle split tabbed

# Scratchpads
bindsym Mod4+minus scratchpad show
bindsym Mod4+Shift+minus move scratchpad

# Media
bindsym --locked XF86AudioPlay         exec playerctl play-pause
bindsym --locked Shift+XF86AudioPlay   exec playerctl pause
bindsym --locked Control+XF86AudioPlay exec playerctl stop
bindsym --locked XF86AudioPrev         exec playerctl position 1-
bindsym --locked Shift+XF86AudioPrev   exec playerctl position 10-
bindsym --locked Control+XF86AudioPrev exec playerctl previous
bindsym --locked XF86AudioNext         exec playerctl position 1+
bindsym --locked Shift+XF86AudioNext   exec playerctl position 10+
bindsym --locked Control+XF86AudioNext exec playerctl next

# Volume
set $send_volume_notif wpctl get-volume @DEFAULT_SINK@ | (read _ v m && v=$(printf "%.0f" $(echo "100*$v" | bc)) && notify-send --category osd --hint "int:value:$v" "Volume: $v% $m")
bindsym --locked XF86AudioMute                      exec wpctl set-mute   @DEFAULT_SINK@ toggle && $send_volume_notif
bindsym --locked Shift+XF86AudioMute                exec                                           $send_volume_notif
bindsym --locked Control+XF86AudioMute              exec wpctl set-mute   @DEFAULT_SINK@ 1      && $send_volume_notif
bindsym --locked XF86AudioLowerVolume               exec wpctl set-volume @DEFAULT_SINK@ 1%-    && $send_volume_notif
bindsym --locked Shift+XF86AudioLowerVolume         exec wpctl set-volume @DEFAULT_SINK@ 10%-   && $send_volume_notif
bindsym --locked Control+XF86AudioLowerVolume       exec wpctl set-volume @DEFAULT_SINK@ 0%     && $send_volume_notif
bindsym --locked XF86AudioRaiseVolume               exec wpctl set-volume @DEFAULT_SINK@ 1%+    && $send_volume_notif
bindsym --locked Shift+XF86AudioRaiseVolume         exec wpctl set-volume @DEFAULT_SINK@ 10%+   && $send_volume_notif
bindsym --locked Control+XF86AudioRaiseVolume       exec wpctl set-volume @DEFAULT_SINK@ 100%   && $send_volume_notif

# Microphone
# TODO: test me
bindsym --locked --no-repeat                Pause   exec wpctl set-mute @DEFAULT_SOURCE@ off
bindsym --locked --no-repeat --release      Pause   exec wpctl set-mute @DEFAULT_SOURCE@ on
bindsym --locked --no-repeat --whole-window button8 exec wpctl set-mute @DEFAULT_SOURCE@ toggle

# Backlight
set $send_brightness_notif b=$(printf "%.0f" "$(light -G)") && notify-send --category osd --hint "int:value:$b" "Brightness: $b%"
bindsym --locked XF86MonBrightnessDown               exec light -U 1   && $send_brightness_notif
bindsym --locked Shift+XF86MonBrightnessDown         exec light -U 10  && $send_brightness_notif
bindsym --locked Control+XF86MonBrightnessDown       exec light -S 0   && $send_brightness_notif
bindsym --locked XF86MonBrightnessUp                 exec light -A 1   && $send_brightness_notif
bindsym --locked Shift+XF86MonBrightnessUp           exec light -A 10  && $send_brightness_notif
bindsym --locked Control+XF86MonBrightnessUp         exec light -S 100 && $send_brightness_notif

# Screenshots
bindsym Print       exec flameshot gui --delay 50 --raw | wl-copy --type image/png
bindsym Shift+Print exec flameshot gui --delay 50 --raw --accept-on-select | wl-copy --type image/png
