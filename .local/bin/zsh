#!/bin/sh

opt="$HOME/.local/opt/zsh-syntax-highlighting"; [ -d "/usr/share/zsh-syntax-highlighting" ] || [ -d "$opt" ] || { mkdir -p "$opt" && curl -L "https://github.com/zsh-users/zsh-syntax-highlighting/archive/refs/heads/master.tar.gz" | tar -xzC "$opt"; } || { rm -r "$opt"; exit 1; }
opt="$HOME/.local/opt/zsh-autosuggestions"; [ -d "/usr/share/zsh-autosuggestions" ] || [ -d "$opt" ] || { mkdir -p "$opt" && curl -L "https://github.com/zsh-users/zsh-autosuggestions/archive/refs/heads/master.tar.gz" | tar -xzC "$opt"; } || { rm -r "$opt"; exit 1; }
opt="$HOME/.local/opt/fzf-scripts"; [ -d "/usr/share/doc/fzf/examples" ] || [ -d "$opt" ] || { mkdir -p "$opt" && curl -L "https://download-directory.github.io?url=https://github.com/junegunn/fzf/tree/master/shell" > "$opt/scripts.zip" && unzip "$opt/scripts.zip" -d "$opt"; } || { rm -r "$opt"; exit 1; }

export PATH=$(echo "$PATH" | tr ":" "\n" | grep -v "$(dirname -- "$0")" | tr "\n" ":")

hash zsh 2>/dev/null && exec zsh $@

case "$(uname --machine)" in
	"x86_64"*) opt="$HOME/.local/opt/zsh/x86_64"; bin="$opt/bin/zsh";;
	"arm"*)    opt="$HOME/.local/opt/zsh/arm64";  bin="$opt/bin/zsh";;
esac

[ -d "$opt" ] || sh -c "$(curl -fL https://raw.githubusercontent.com/romkatv/zsh-bin/master/install)" -- -d "$opt" -e no || { rm -r "$opt"; exit 1; }

exec "$bin" $@
