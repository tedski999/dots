#!/bin/sh

export PATH=$(echo "$PATH" | tr ":" "\n" | grep -v "$(dirname -- "$0")" | tr "\n" ":")

hash delta 2>/dev/null && exec delta $@

case "$(uname --machine)" in
	"x86_64"*) opt="$HOME/.local/opt/delta/x86_64"; bin="$opt/delta-0.16.5-x86_64-unknown-linux-musl/delta"; src="https://github.com/dandavison/delta/releases/download/0.16.5/delta-0.16.5-x86_64-unknown-linux-musl.tar.gz";;
	"arm"*)    opt="$HOME/.local/opt/delta/arm64";  bin="$opt/delta-0.16.5-arm-unknown-linux-gnueabihf/delta"; src="https://github.com/dandavison/delta/releases/download/0.16.5/delta-0.16.5-arm-unknown-linux-gnueabihf.tar.gz";;
esac

[ -d "$opt" ] || { mkdir -p "$opt" && curl -fL "$src" | tar -xzC "$opt"; } || { rm -r "$opt"; exit 1; }

exec "$bin" $@
