#!/usr/bin/env fish

# Persistant sticky floating programs
# Dependencies: xdotool bspc alacritty

not set --query argv[1]; and set argv[1] "toggle"
not set --query argv[2]; and set argv[2] "fish"
set action $argv[1]
set command $argv[2]

set name "scratchpad $command"
set id (xdotool search --classname $name)

if test $id
	test $action = "toggle"
	and bspc node $id --flag hidden --focus
	test $action = "snap"
	and bspc node $id --flag hidden=off --flag sticky=off --state tiled --focus
	and xdotool set_window --classname "Alacritty" $id
else
	test $action = "snap"
	or bspc rule --add "*" --one-shot sticky=on state=floating monitor=primary
	alacritty --class $name --command $command &
end

return 0
