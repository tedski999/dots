#!/bin/sh

for bin in $(realpath $(which -a exa)); do
	[ "$(realpath $0)" != "$bin" ] && [ -x "$bin" ] && exec "$bin" "$@"
done

case "$(uname --machine)" in
	"x86_64"*) opt="$HOME/.local/opt/exa/x86_64"; bin="$opt/bin/exa"; src="https://github.com/ogham/exa/releases/download/v0.10.1/exa-linux-x86_64-musl-v0.10.1.zip";;
	"arm"*)    opt="$HOME/.local/opt/exa/arm64";  bin="$opt/bin/exa"; src="https://github.com/ogham/exa/releases/download/v0.10.1/exa-linux-armv7-v0.10.1.zip";;
esac

[ -d "$opt" ] || { mkdir -p "$opt" && curl -fL "$src" > "$opt/exa.zip" && unzip "$opt/exa.zip" -d "$opt"; } || { rm -r "$opt"; exit 1; }

exec "$bin" "$@"
