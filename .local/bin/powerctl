#!/bin/sh

choice="$1"
[ -z "$choice" ] && {
	caffinate="$(pidof -q swayidle && echo "caffinate" || echo "uncaffinate")"
	choices="lock suspend $caffinate reload logout reboot shutdown"
	choice="$(CH_LINES=9 CH_WIDTH=100 CH_PROMPT="Power Control" choose $choices)"
}

case "$choice" in
	"lock") loginctl lock-session;;
	"suspend") systemctl suspend;;
	"reload") swaymsg reload;;
	"logout") swaymsg exit;;
	"reboot") systemctl reboot;;
	"shutdown") systemctl poweroff;;
	"caffinate") pkill swayidle;;
	"uncaffinate") pidof swayidle || swayidle -w \
		idlehint 300 lock 'swaylock --daemonize' unlock 'pkill -USR1 swaylock' \
		timeout 300 'powerctlfade &'               resume 'pkill powerctlfade' \
		timeout 310 'loginctl lock-session'        resume 'pkill powerctlfade' \
		timeout 900 'systemctl suspend'            resume 'pkill powerctlfade' \
		before-sleep 'loginctl lock-session' after-resume 'pkill powerctlfade' &;;
	*) return 1;;
esac
